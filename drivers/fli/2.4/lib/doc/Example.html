<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<HTML>
<HEAD>
   <TITLE> Example</TITLE>
   <META NAME="GENERATOR" CONTENT="DOC++ 3.4.8">
</HEAD>
<BODY BGCOLOR="#ffffff">

<H2> <A HREF="#DOC.DOCU">Example</A></H2></H2><A NAME="DOC.DOCU"></A>
<BLOCKQUOTE>
<PRE>
#&nbsp;if&nbsp;0

&nbsp;&nbsp;Copyright&nbsp;(c)&nbsp;2000,&nbsp;2002&nbsp;Finger&nbsp;Lakes&nbsp;Instrumentation&nbsp;(FLI),&nbsp;LLC.
&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.

&nbsp;&nbsp;Redistribution&nbsp;and&nbsp;use&nbsp;in&nbsp;source&nbsp;and&nbsp;binary&nbsp;forms,&nbsp;with&nbsp;or&nbsp;without
&nbsp;&nbsp;modification,&nbsp;are&nbsp;permitted&nbsp;provided&nbsp;that&nbsp;the&nbsp;following&nbsp;conditions
&nbsp;&nbsp;are&nbsp;met:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Redistributions&nbsp;of&nbsp;source&nbsp;code&nbsp;must&nbsp;retain&nbsp;the&nbsp;above&nbsp;copyright
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;notice,&nbsp;this&nbsp;list&nbsp;of&nbsp;conditions&nbsp;and&nbsp;the&nbsp;following&nbsp;disclaimer.

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Redistributions&nbsp;in&nbsp;binary&nbsp;form&nbsp;must&nbsp;reproduce&nbsp;the&nbsp;above
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;copyright&nbsp;notice,&nbsp;this&nbsp;list&nbsp;of&nbsp;conditions&nbsp;and&nbsp;the&nbsp;following
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;disclaimer&nbsp;in&nbsp;the&nbsp;documentation&nbsp;and/or&nbsp;other&nbsp;materials
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;provided&nbsp;with&nbsp;the&nbsp;distribution.

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Neither&nbsp;the&nbsp;name&nbsp;of&nbsp;Finger&nbsp;Lakes&nbsp;Instrumentation&nbsp;(FLI),&nbsp;LLC
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nor&nbsp;the&nbsp;names&nbsp;of&nbsp;its&nbsp;contributors&nbsp;may&nbsp;be&nbsp;used&nbsp;to&nbsp;endorse&nbsp;or
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promote&nbsp;products&nbsp;derived&nbsp;from&nbsp;this&nbsp;software&nbsp;without&nbsp;specific
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prior&nbsp;written&nbsp;permission.

&nbsp;&nbsp;THIS&nbsp;SOFTWARE&nbsp;IS&nbsp;PROVIDED&nbsp;BY&nbsp;THE&nbsp;COPYRIGHT&nbsp;HOLDERS&nbsp;AND&nbsp;CONTRIBUTORS
&nbsp;&nbsp;``AS&nbsp;IS''&nbsp;AND&nbsp;ANY&nbsp;EXPRESS&nbsp;OR&nbsp;IMPLIED&nbsp;WARRANTIES,&nbsp;INCLUDING,&nbsp;BUT&nbsp;NOT
&nbsp;&nbsp;LIMITED&nbsp;TO,&nbsp;THE&nbsp;IMPLIED&nbsp;WARRANTIES&nbsp;OF&nbsp;MERCHANTABILITY&nbsp;AND&nbsp;FITNESS
&nbsp;&nbsp;FOR&nbsp;A&nbsp;PARTICULAR&nbsp;PURPOSE&nbsp;ARE&nbsp;DISCLAIMED.&nbsp;IN&nbsp;NO&nbsp;EVENT&nbsp;SHALL&nbsp;THE
&nbsp;&nbsp;REGENTS&nbsp;OR&nbsp;CONTRIBUTORS&nbsp;BE&nbsp;LIABLE&nbsp;FOR&nbsp;ANY&nbsp;DIRECT,&nbsp;INDIRECT,
&nbsp;&nbsp;INCIDENTAL,&nbsp;SPECIAL,&nbsp;EXEMPLARY,&nbsp;OR&nbsp;CONSEQUENTIAL&nbsp;DAMAGES&nbsp;(INCLUDING,
&nbsp;&nbsp;BUT&nbsp;NOT&nbsp;LIMITED&nbsp;TO,&nbsp;PROCUREMENT&nbsp;OF&nbsp;SUBSTITUTE&nbsp;GOODS&nbsp;OR&nbsp;SERVICES;
&nbsp;&nbsp;LOSS&nbsp;OF&nbsp;USE,&nbsp;DATA,&nbsp;OR&nbsp;PROFITS;&nbsp;OR&nbsp;BUSINESS&nbsp;INTERRUPTION)&nbsp;HOWEVER
&nbsp;&nbsp;CAUSED&nbsp;AND&nbsp;ON&nbsp;ANY&nbsp;THEORY&nbsp;OF&nbsp;LIABILITY,&nbsp;WHETHER&nbsp;IN&nbsp;CONTRACT,&nbsp;STRICT
&nbsp;&nbsp;LIABILITY,&nbsp;OR&nbsp;TORT&nbsp;(INCLUDING&nbsp;NEGLIGENCE&nbsp;OR&nbsp;OTHERWISE)&nbsp;ARISING&nbsp;IN
&nbsp;&nbsp;ANY&nbsp;WAY&nbsp;OUT&nbsp;OF&nbsp;THE&nbsp;USE&nbsp;OF&nbsp;THIS&nbsp;SOFTWARE,&nbsp;EVEN&nbsp;IF&nbsp;ADVISED&nbsp;OF&nbsp;THE
&nbsp;&nbsp;POSSIBILITY&nbsp;OF&nbsp;SUCH&nbsp;DAMAGE.

&nbsp;&nbsp;======================================================================

&nbsp;&nbsp;Finger&nbsp;Lakes&nbsp;Instrumentation&nbsp;(FLI)
&nbsp;&nbsp;web:&nbsp;http://www.fli-cam.com
&nbsp;&nbsp;email:&nbsp;fli@rpa.net

#&nbsp;endif

#include&nbsp;&lt;stdio.h&gt;
#include&nbsp;&lt;string.h&gt;
#include&nbsp;&lt;stdlib.h&gt;
#include&nbsp;&lt;sys/types.h&gt;
#include&nbsp;&lt;unistd.h&gt;
#include&nbsp;&quot;fli.h&quot;

#define&nbsp;DEFAULT_CCD_CHAR_FILE&nbsp;&quot;/dev/ccd0&quot;
#define&nbsp;DEFAULT_EXPOSURE_TIME&nbsp;50

#define&nbsp;TRY_FUNCTION(function,&nbsp;args...)				\
&nbsp;&nbsp;do&nbsp;{								\
&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;err;							\
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((err&nbsp;=&nbsp;function(args)))					\
&nbsp;&nbsp;&nbsp;&nbsp;{								\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(stderr,						\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;Error&nbsp;&quot;&nbsp;#function&nbsp;&quot;:&nbsp;%s\n&quot;,&nbsp;strerror(-err));	\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(1);							\
&nbsp;&nbsp;&nbsp;&nbsp;}								\
&nbsp;&nbsp;}&nbsp;while(0)

void&nbsp;usage(char&nbsp;*name)
{
&nbsp;&nbsp;printf(&quot;\n&quot;);
&nbsp;&nbsp;printf(&quot;&nbsp;&nbsp;Usage:&nbsp;%s&nbsp;[-e&nbsp;&lt;exposure&nbsp;time&nbsp;(msec)&gt;]&nbsp;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;[&lt;ccd&nbsp;device&nbsp;filename&gt;]&nbsp;\\\n&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;output&nbsp;file&nbsp;name&gt;\n&quot;,&nbsp;name);
&nbsp;&nbsp;printf(&quot;\n&quot;);
&nbsp;&nbsp;printf(&quot;&nbsp;&nbsp;&nbsp;&nbsp;Examples:&nbsp;%s&nbsp;-e&nbsp;50&nbsp;/dev/ccd0&nbsp;testfile.1.out\n&quot;,&nbsp;name);
&nbsp;&nbsp;printf(&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%s&nbsp;-e&nbsp;100&nbsp;/dev/ccd0&nbsp;-&nbsp;&gt;&nbsp;testfile.2.out\n&quot;,&nbsp;name);
&nbsp;&nbsp;printf(&quot;\n&quot;);
&nbsp;&nbsp;printf(&quot;&nbsp;&nbsp;&nbsp;&nbsp;(An&nbsp;output&nbsp;file&nbsp;name&nbsp;of&nbsp;`-'&nbsp;writes&nbsp;data&nbsp;to&nbsp;standard&nbsp;output.)\n&quot;);
&nbsp;&nbsp;printf(&quot;\n&quot;);

&nbsp;&nbsp;exit(0);
}

int&nbsp;main(int&nbsp;argc,&nbsp;char&nbsp;*argv[])
{
&nbsp;&nbsp;fliport_t&nbsp;port;
&nbsp;&nbsp;flicam_t&nbsp;cam;
&nbsp;&nbsp;int&nbsp;ul_x,&nbsp;ul_y,&nbsp;lr_x,&nbsp;lr_y;
&nbsp;&nbsp;u_int16_t&nbsp;*buff;
&nbsp;&nbsp;int&nbsp;buffsize,&nbsp;bytesgrabbed;
&nbsp;&nbsp;FILE&nbsp;*outfile;
&nbsp;&nbsp;int&nbsp;err;
&nbsp;&nbsp;char&nbsp;*ccd_char_file,&nbsp;*outfilename;
&nbsp;&nbsp;int&nbsp;exptime&nbsp;=&nbsp;DEFAULT_EXPOSURE_TIME;

&nbsp;&nbsp;while&nbsp;(1)
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;opt;
&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*endptr;

&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((opt&nbsp;=&nbsp;getopt(argc,&nbsp;argv,&nbsp;&quot;e:&quot;))&nbsp;==&nbsp;-1)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;

&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(opt)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;'e':
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exptime&nbsp;=&nbsp;strtol(optarg,&nbsp;&amp;endptr,&nbsp;0);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(*endptr&nbsp;!=&nbsp;'\0')
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Invalid&nbsp;exposure&nbsp;time&nbsp;[%s].\n&quot;,&nbsp;optarg);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usage(argv[0]);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;

&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;'?':
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usage(argv[0]);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;

&nbsp;&nbsp;&nbsp;&nbsp;default:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Unknown&nbsp;return&nbsp;value&nbsp;from&nbsp;getopt&nbsp;[%i],&nbsp;exiting.\n&quot;,&nbsp;opt);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(1);
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;}

&nbsp;&nbsp;switch&nbsp;(argc&nbsp;-&nbsp;optind)
&nbsp;&nbsp;{
&nbsp;&nbsp;case&nbsp;1:
&nbsp;&nbsp;&nbsp;&nbsp;ccd_char_file&nbsp;=&nbsp;DEFAULT_CCD_CHAR_FILE;
&nbsp;&nbsp;&nbsp;&nbsp;outfilename&nbsp;=&nbsp;argv[optind];
&nbsp;&nbsp;&nbsp;&nbsp;break;

&nbsp;&nbsp;case&nbsp;2:
&nbsp;&nbsp;&nbsp;&nbsp;ccd_char_file&nbsp;=&nbsp;argv[optind++];
&nbsp;&nbsp;&nbsp;&nbsp;outfilename&nbsp;=&nbsp;argv[optind];
&nbsp;&nbsp;&nbsp;&nbsp;break;

&nbsp;&nbsp;default:
&nbsp;&nbsp;&nbsp;&nbsp;printf&nbsp;(&quot;Invalid&nbsp;number&nbsp;of&nbsp;arguments.\n&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;usage(argv[0]);
&nbsp;&nbsp;}

&nbsp;&nbsp;TRY_FUNCTION(FLIInit,&nbsp;ccd_char_file,&nbsp;&amp;port);
&nbsp;&nbsp;TRY_FUNCTION(FLIOpen,&nbsp;port,&nbsp;NULL,&nbsp;&amp;cam);
&nbsp;&nbsp;TRY_FUNCTION(FLIGetVisibleArea,&nbsp;cam,&nbsp;&amp;ul_x,&nbsp;&amp;ul_y,&nbsp;&amp;lr_x,&nbsp;&amp;lr_y);
&nbsp;&nbsp;TRY_FUNCTION(FLISetImageArea,&nbsp;cam,&nbsp;ul_x,&nbsp;ul_y,&nbsp;lr_x,&nbsp;lr_y);
&nbsp;&nbsp;TRY_FUNCTION(FLISetBitDepth,&nbsp;cam,&nbsp;FLI_MODE_16BIT);
&nbsp;&nbsp;TRY_FUNCTION(FLISetExposureTime,&nbsp;cam,&nbsp;exptime);

&nbsp;&nbsp;buffsize&nbsp;=&nbsp;(lr_x&nbsp;-&nbsp;ul_x)&nbsp;*&nbsp;(lr_y&nbsp;-&nbsp;ul_y)&nbsp;*&nbsp;sizeof(u_int16_t);

&nbsp;&nbsp;if&nbsp;((buff&nbsp;=&nbsp;malloc(buffsize))&nbsp;==&nbsp;NULL)
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;perror(&quot;Error&nbsp;malloc&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;exit(1);
&nbsp;&nbsp;}

&nbsp;&nbsp;if&nbsp;((err&nbsp;=&nbsp;FLIGrabFrame(cam,&nbsp;buff,&nbsp;buffsize,&nbsp;&amp;bytesgrabbed)))
&nbsp;&nbsp;&nbsp;&nbsp;fprintf(stderr,&nbsp;&quot;Error&nbsp;FLIGrabFrame:&nbsp;%s\n&quot;,&nbsp;strerror(-err));

&nbsp;&nbsp;if&nbsp;(bytesgrabbed&nbsp;&gt;&nbsp;0)
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(strcmp(outfilename,&nbsp;&quot;-&quot;)&nbsp;==&nbsp;0)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outfile&nbsp;=&nbsp;stdout;
&nbsp;&nbsp;&nbsp;&nbsp;else
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((outfile&nbsp;=&nbsp;fopen(outfilename,&nbsp;&quot;w&quot;))&nbsp;==&nbsp;NULL)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;perror(&quot;Error&nbsp;fopen&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(1);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(fwrite(buff,&nbsp;1,&nbsp;bytesgrabbed,&nbsp;outfile)&nbsp;!=&nbsp;bytesgrabbed)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;perror(&quot;Error&nbsp;fwrite&quot;);
&nbsp;&nbsp;}

&nbsp;&nbsp;TRY_FUNCTION(FLIClose,&nbsp;cam);
&nbsp;&nbsp;TRY_FUNCTION(FLIExit);

&nbsp;&nbsp;exit(0);
}
</PRE>
</BLOCKQUOTE>
<DL><DT><DD></DL><P><P><I><A HREF="index.html">Alphabetic index</A></I></P><HR>
<BR>
This page was generated with the help of <A HREF="http://docpp.sourceforge.net">DOC++</A>.
</BODY>
</HTML>
