CXX      = @CXX@
CXXFLAGS = @CXXFLAGS@ @X_CFLAGS@ @DEFS@
LDFLAGS  = @LDFLAGS@
LIBS     = @X_LIBS@ @X_EXTRA_LIBS@

srcdir      = @srcdir@
prefix      = @prefix@
exec_prefix = @exec_prefix@
bindir      = @bindir@
man1dir     = @mandir@/man1
VPATH       = @srcdir@

INSTALL         = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA    = @INSTALL_DATA@

.SUFFIXES:	.C

.C.o:
	$(CXX) -c $(CXXFLAGS) $<

TARGET=	dxpc

all: $(TARGET)

pure: pure_$(TARGET)
quantify: quant_$(TARGET)

SRCS=	main.C util.C constants.C Stats.C \
	Multiplexer.C ClientMultiplexer.C ServerMultiplexer.C \
	ClientChannel.C ServerChannel.C ReadBuffer.C \
	ProxyReadBuffer.C ClientReadBuffer.C ServerReadBuffer.C \
	EncodeBuffer.C DecodeBuffer.C WriteBuffer.C \
	IntCache.C CharCache.C PixelCache.C HuffmanCoder.C \
	ClientCache.C ServerCache.C \
	TextCompressor.C LastPixels.C SequenceNumQueue.C \
	BlockCache.C BlockCacheSet.C 

OBJS=	$(SRCS:.C=.o)

$(TARGET):	$(OBJS)
	$(CXX) $(CXXFLAGS) -o $@ $(OBJS) $(LDFLAGS) $(LIBS)

pure_$(TARGET):	$(OBJS)
	purify $(CXX) $(CXXFLAGS) -o $@ $(OBJS) $(LDFLAGS) $(LIBS)

quant_$(TARGET):	$(OBJS) $(OBJS)
	quantify $(CXX) $(CXXFLAGS) -o $@ $(OBJS) $(LDFLAGS) $(LIBS)

depends:	
	makedepend -f Makefile $(SRCS)

install: install.bin install.man

install.bin:	$(TARGET)
	$(srcdir)/mkinstalldirs $(bindir)
	$(INSTALL) $(TARGET) $(bindir)/$(TARGET)

install.man:
	$(srcdir)/mkinstalldirs $(man1dir)
	$(INSTALL_DATA) $(TARGET).man $(man1dir)/$(TARGET).1

clean:
	-rm -f *~ *.o $(TARGET) pure_* quant_* *.bak core gmon.out

distclean: clean
	-rm -f config.status config.log config.cache Makefile tags
